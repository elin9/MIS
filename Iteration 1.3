using System;
using System.Windows.Forms;
using System.Drawing;
using System.Diagnostics;
using System.Threading;
using System.Threading.Tasks;

public class Butevent:Form  {

	static RichTextBox t1 = new RichTextBox();

	static string[] characters = {
		"q",
		"w",
		"e",
		"r",
		"t",
		"y",
		"u",
		"i",
		"o",
		"p",
		"a",
		"s",
		"d",
		"f",
		"g",
		"h",
		"j",
		"k",
		"l",
		"TAB",
		"z",
		"x",
		"c",
		"v",
		"SPACE",
		"b",
		"n",
		"m",
		"ENTER",
		"BACK SPACE",
		"123  #+=",		//toggle for numbers and other characters
		"ABC",			//toggle for uppercase
		"COPY",
		"PASTE",
		"CLEAR"
	};

	static string[] numpunc = {
		"1",
		"2",
		"3",
		"4",
		"5",
		"6",
		"7",
		"8",
		"9",
		"0",
		".",
		",",
		"?",
		"!",
		":",
		";",
		"\'",
		"\"",
		"/",
		"TAB",
		"(",
		")",
		"-",
		"*",
		"SPACE",
		"@",
		"=",
		"+",
		"ENTER",
		"BACK SPACE",
		"abc",			//toggle for lowercase
		"ABC",			//toggle for uppercase
		"COPY",
		"PASTE",
		"CLEAR"
	};

	static int clength = characters.Length;
	static Button[] buttons = new Button[clength];

	static int wwidth = 1200;		//window width
	static int wheight = 550;		//window height

	public Butevent() {
		this.Size = new System.Drawing.Size(wwidth, wheight);
		this.BackColor = System.Drawing.Color.Lavender;
		this.Location = new Point (-500, 500);
		this.Controls.Add(t1);
		this.MouseLeave += new EventHandler (OnMouseLeaveForm);		//for window transparency
		this.MouseEnter += new EventHandler (OnMouseEnterForm);		//for window opacity
		this.Resize += new EventHandler (OnResizeWindow);

		this.Width = wwidth;
		this.Height = wheight;

		t1.Location = new Point(5,5);
		t1.Size = new Size (1150, 30);
		t1.Font = new Font("Tahoma", 15);
		t1.GotFocus += new EventHandler (OnGotFocus);
		t1.MouseEnter += new EventHandler (OnMouseEnterForm);		//for window opacity

		int x = 50;
		int y = 50;

		for (int i = 0; i < characters.Length; i++) {
			buttons[i] = new Button();
			buttons[i].Font = new Font ("Tahoma", 16);
			buttons[i].Text = characters[i];
			buttons[i].Size = new Size (60, 60);
			buttons[i].BackColor = System.Drawing.Color.MintCream;

			//Hover over action
			buttons[i].MouseEnter += new EventHandler(OnMouseEnter);
			buttons[i].MouseLeave += new EventHandler(OnMouseLeave);

			//Click action (not applied to special keys: "123 #+=", "abc", "ABC", "COPY", "PASTE", "CLEAR")
			if (i < 30) {
				buttons [i].MouseDown += new MouseEventHandler (OnMouseDown);
				buttons [i].MouseUp += new MouseEventHandler (OnMouseUp);
			}

			if (buttons[i].Text.Length > 3)
				buttons[i].Font = new Font ("Tahoma", 10);

			//Grid layout
			buttons[i].Location = new Point(x, y);
			x += 110;
			if (i == 9 || i == 19 || i == 29 || i == 39) {
				y += 130;
				x = 50;
			}

			this.Controls.Add(buttons[i]);
		}
	} //end of Butevent

	/**
	 * Actions for hover over event 
	 * if's and elseif's deal with special keys
	*/
	public void OnMouseEnter(object sender,EventArgs e) {
		Button b0 = sender as Button;
		b0.BackColor = System.Drawing.Color.Thistle;
		this.Opacity = 1;

		if (b0.Text == "SPACE") {
			t1.Text += " ";
		} else if (b0.Text == "ENTER") {
			t1.Text += "\n";
			t1.Size = new Size (1150, 40);
		} else if (b0.Text == "BACK SPACE") {
			if (t1.Text.Length > 0)
				t1.Text = t1.Text.Remove (t1.Text.Length - 1, 1);
		} else if (b0.Text == "TAB") {
			t1.Text += "\t";
		} else if (b0.Text == "123  #+=") {					//toggle to numbers and other symbols
			for (int i = 0; i < characters.Length; i++) {
				buttons [i].Text = numpunc [i];
			}
		} else if (b0.Text == "abc") {						//toggle back to lowercase letters
			for (int i = 0; i < characters.Length; i++) {
				buttons [i].Text = characters [i];
			}
		} else if (b0.Text == "ABC") {						//toggle to uppercase letters
			for (int i = 0; i < characters.Length; i++) {
				buttons [i].Text = characters [i].ToUpper();
			}
			b0.Text = "abc";
		} else if (b0.Text == "COPY") {
			t1.SelectAll ();
			t1.Focus ();
			t1.Copy ();
		} else if (b0.Text == "PASTE") {
			t1.Paste ();
		} else if (b0.Text == "CLEAR") {
			DialogResult r1 = MessageBox.Show ("Are you sure you want to clear all?", "Deleting all...", MessageBoxButtons.YesNo, MessageBoxIcon.Question);
			if(r1 == DialogResult.Yes) t1.Text = "";
		}
		else t1.Text += b0.Text;

		//Highlighting functionality
		if (b0.Text == "COPY") {
			t1.SelectionStart = 0;
			t1.SelectionLength = t1.Text.Length;
			t1.SelectionBackColor = Color.LightBlue;
		} else {
			t1.SelectionStart = 0;
			t1.SelectionLength = t1.Text.Length;
			t1.SelectionBackColor = Color.White;
		}

		t1.Focus();
		t1.SelectionStart = t1.Text.Length; //text cursor location
	} //end of MouseEnter method

	/**
	 * End of hover over action
	*/
	public void OnMouseLeave(object sender,EventArgs e) {
		Button b0 = sender as Button;
		b0.BackColor = System.Drawing.Color.MintCream;
	}

	/**
	 * Window stays opaque when mouse is on the form
	*/
	public void OnMouseEnterForm(object sender,EventArgs e) {
		this.Opacity = 1;
	}
	/**
	 * Window becomes transparent when mouse leaves form
	 * ***Needs debugging***
	 * Not recognizing the edges of the windows as a part of the form
	*/
	public void OnMouseLeaveForm(object sender,EventArgs e) {
		this.Opacity = .50;
	}

	/**
	 * Functionality for resizing the window, which scales all buttons and fonts proportionally
	*/
	public void OnResizeWindow(object sender, EventArgs e) {
		wwidth = this.Width;
		wheight = this.Height;
		t1.Anchor = (AnchorStyles.Top | AnchorStyles.Right | AnchorStyles.Left);
		int x1 = 50;
		int y1 = 50;
		for (int i = 0; i < buttons.Length; i++) {
			buttons[i].Size = new Size (wwidth/20, wwidth/20);
			buttons[i].Location = new Point(x1, y1);
			buttons[i].Font = new Font ("Tahoma", wwidth/75);
			x1 += wwidth/(120/10);
			if (i == 9 || i == 19 || i == 29 || i == 39) {
				y1 += wwidth/ (120/11);
				x1 = 50;
			}
			if (buttons[i].Text.Length > 2)
				buttons[i].Font = new Font ("Tahoma", wwidth/120);
		}
	}

	/**
	 * Actions for click event
	 * (AKA the solution to our "backspace problem": holding down a key types that key continuously at a certain pace)
	*/
	private bool buttonDown;
	public async void OnMouseDown(object sender, EventArgs e) {
		Button b0 = sender as Button;
		b0.BackColor = System.Drawing.Color.Plum;

		buttonDown = true;

		while (buttonDown) {
			if (b0.Text == "SPACE") {
				t1.Text += " ";
			} else if (b0.Text == "ENTER") {
				t1.Text += "\n";
				t1.Size = new Size (1150, 40);
			} else if (b0.Text == "BACK SPACE") {
				if (t1.Text.Length > 0)
					t1.Text = t1.Text.Remove (t1.Text.Length - 1, 1);
			} else if (b0.Text == "TAB") {
				t1.Text += "\t";
			}
			else t1.Text += b0.Text;

			t1.Focus();
			t1.SelectionStart = t1.Text.Length; //text cursor location

			await Task.Delay(80); //timing interval
		}
	} //end of OnMouseDown

	/**
	 * End of click event
	 * Stops the while loop from "OnMouseDown" method
	*/
	public void OnMouseUp(object sender, EventArgs e) {
		Button b0 = sender as Button;
		b0.BackColor = System.Drawing.Color.MintCream;

		buttonDown = false;
	}

	/**
	 * Puts the textbox in focus
	*/
	public void OnGotFocus(object sender, EventArgs e) {
		t1.Tag = true;
	}

	//Main
	public static void Main() {
		Application.Run(new Butevent());
	} //end of main

} //end of class

